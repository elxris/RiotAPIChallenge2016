include mixing

doctype html
head
  title Poro Couch
  script(src="http://cdnjs.cloudflare.com/ajax/libs/vue/1.0.21/vue.min.js")
  link(rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css")
  link(rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons")
  link(rel="stylesheet" href="/css/app.css")
  meta(name="viewport" content="width=device-width, initial-scale=1.0")
body.grey-text.text-lighten-4.blue-grey.lighten-4
  #app.row.indigo.darken-5(style="margin-bottom: 0;").indigo
    .col.s12.m4.indigo.darken-3.sidebar
      .container.padding-5vh.center-align: .row
        .col.s12
          .row
            .col.s12.left-align.margin-1em
              label.indigo-text.text-lighten-4 Region
              select.browser-default.indigo(v-model='region' debounce='999')
                option(value='', disabled v-bind:selected="!region") Region
                option(v-for="r in regions" v-bind:value='r' v-bind:selected="region === r") {{r}}
            .input-field.col.s12.margin-1em
              input#first_name(type='text' v-model='name' debounce='999' v-bind:class="[userData === null ? 'red-text': '']")
              label.indigo-text.text-lighten-4(for='first_name') Summoner Name
        .row(v-if='userData && name && region')
          .col.s12.margin-1em
            img.circle.responsive-img.z-depth-3(v-bind:src="profileIcon")
          .col.s12.waves-effect.waves-light.margin-1em
            p.flow-text Menú #1
          .col.s12.waves-effect.waves-light.margin-1em
            p.flow-text Menú #2
          .col.s12.waves-effect.waves-light.margin-1em
            p.flow-text Menú #3
        .col.s12(v-if='userData === \'\' && name && region')
          +loader

    .col.s12.m8
      .container.padding-5vh
        .card
          .card-content.black-text.center-align
            h2.flow-text Welcome Summoner!
            h3.flow-text
              | We know you love League of Legends, and maybe you want to be a better player but is not always that easy, sometimes we stuck ourselves in one league, and we don't know how to upgrade our skills.
            h3.flow-text
              | We came to make that easy! Just let a Poro Coach you based on your progress and challenging you to get better.
  footer.indigo.darken-2(style="padding-top: 1em; padding-bottom: 1em;")
    .container
      | © 2014 Copyright Text
      a.grey-text.text-lighten-4.right(href='#!') More Links

  script(src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js")
  script(src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js")
  script.
    $(".button-collapse").sideNav({
      menuWidth: 300, // Default is 240
      edge: 'right', // Choose the horizontal origin
    });
    $('.collapsible').collapsible();
    new Vue({
      el: '#app',
      data: {
        name: '',
        region: '',
        regions: ["BR","EUNE","EUW","JP","KR","LAN","LAS","NA","OCE","RU","TR"],
        userData: ''
      },
      computed: {
        profileIcon: function( ) {
          var base = 'http://ddragon.leagueoflegends.com/cdn/6.9.1/img/profileicon/';
          return base + ((this.userData||{}).profileIconId || 588) + '.png'
        }
      },
      watch: {
        'region': function(val) {
          console.log(val);
          localStorage.setItem("region", val);
          this.obtainData();
        },
        'name': function(val) {
          console.log(val);
          localStorage.setItem("name", val);
          this.obtainData();
        }
      },
      created: function() {
        this.region = localStorage.getItem("region");
        this.name   = localStorage.getItem("name");
      },
      methods: {
        obtainData: function() {
          var self = this;
          if(this.region && this.name) {
            self.userData = '';
            $.post('/api/summoner',
              {
                name: this.name.split(/\s/g).join('').toLowerCase(),
                region: this.region
              }, 
              function(data) {
                self.userData = data;
                console.log(data);
              }
            ).fail(function() {
              self.userData = null;
            });
          }
        }
      }
    });
